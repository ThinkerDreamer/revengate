#:kivy 2.0.0
#:include revengate/forms.kv
#:include revengate/stats_screen.kv
#:import tender revengate.tender

<MapWidget>
    app: app
    do_rotation: False

        
<MainScreenButton@MDRectangleFlatButton>:
    pos_hint: {"center_x": 0.5}

<HeroStatusBox>:
    orientation: "horizontal"
    name_lbl: name_lbl
    health_lbl: health_lbl
    
    MDLabel:
        id: name_lbl
        adaptive_width: True
        text: "name goes here"

    MDLabel:
        id: health_lbl
        adaptive_width: True
        text: "HP: no as good as we'd like"

ScreenManager:
    app: app
    id: sm
    map_wid: map_wid
    resume_game_bt: resume_game_bt
    select_mode_lbl: select_mode_lbl
    messages_lbl_cont: messages_lbl_cont
    stats_screen: stats_screen
    hero_status: hero_status
    
    MDScreen:
        name: 'main_screen'
        
        MDBoxLayout:
            spacing: "32dp"
            padding: "32dp"
            orientation: "vertical"
            halign: "center"
            width: self.parent.width

            MDLabel:
                halign: "center"
                text: "Welcome to Revengate!"
                font_size: "45sp"
                font_weight: "bold"
                
            MainScreenButton:
                id: new_game_bt
                text: "New Game"
                on_press: app.root.transition.center_on_button()
                on_release: app.start_new_game()
            
            MainScreenButton:
                id: resume_game_bt
                disabled: not app.has_saved_game()
                text: "Resume"
                on_release: app.show_map_screen(*args)

    Screen:
        name: 'map_screen'
        on_enter: app.focus_map()
        
        FloatLayout:
            on_size: map_wid.center_on_hero()
            
            MapWidget:
                id: map_wid
                do_collide_after_children: False
                auto_bring_to_front: False
                size_hint_y: 0.9
                pos_hint_x: None
                pos_hint_y: None
            
            BoxLayout:
                size_hint_y: 0.1
                spacing: "16dp"
                padding: "16dp"

                MDRectangleFlatButton:
                    text: "Home"
                    on_release: app.show_main_screen(*args)
                    
                MDRectangleFlatButton:
                    text: "Rest"
                    on_release: map_wid.rest()

                MDRectangleFlatButton:
                    text: "Loot"
                    on_release: map_wid.loot()

                MDRectangleFlatButton:
                    text: "Follow stairs"
                    on_release: map_wid.follow_stairs()
                    
                MDIconButton:
                    icon: "eye-circle"
                    opacity: 0.7
                    on_release: map_wid.start_look(self)

                MDRectangleFlatButton:
                    text: "Stats"
                    on_release: map_wid.start_stats(self)

                MDLabel:
                    id: select_mode_lbl
                    text: ""

                HeroStatusBox:
                    id: hero_status
                    
        AnchorLayout:
            id: anchor_cont
            padding: "16dp"
            anchor_x: "left"
            anchor_y: "bottom"
            
            MDBoxLayout:
                id: messages_lbl_cont
                orientation: "vertical"

    StatsScreen
        name: 'stats_screen'
        id: stats_screen
