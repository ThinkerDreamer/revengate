#:kivy 2.0.0
#:include revengate/forms.kv
#:import tender revengate

<MapWidget>
    app: app
    do_rotation: False

        
<MainScreenButton@MDRectangleFlatButton>:
    pos_hint: {"center_x": 0.5}


ScreenManager:
    app: app
    id: sm
    map_wid: map_wid
    resume_game_bt: resume_game_bt
    select_mode_lbl: select_mode_lbl
    
    MDScreen:
        name: 'mainscreen'
        
        MDBoxLayout:
            spacing: "32dp"
            padding: "32dp"
            orientation: "vertical"
            halign: "center"
            width: self.parent.width

            MDLabel:
                halign: "center"
                text: "Welcome to Revengate!"
                font_size: "45sp"
                font_weight: "bold"
                
            MainScreenButton:
                id: new_game_bt
                text: "New Game"
                on_press: app.root.transition.center_on_button()
                on_release: app.show_hero_name_form()
            
            MainScreenButton:
                id: resume_game_bt
                disabled: not app.has_saved_game()
                text: "Resume"
                on_release: app.show_map_screen(*args)

    Screen:
        name: 'mapscreen'
        
        FloatLayout:
            on_size: map_wid.center_on_hero()
            
            MapWidget:
                id: map_wid
                do_collide_after_children: False
                auto_bring_to_front: False
                size_hint_y: 0.9
                pos_hint_x: None
                pos_hint_y: None
            
            BoxLayout:
                size_hint_y: 0.1
                spacing: "16dp"
                padding: "16dp"

                MDRectangleFlatButton:
                    text: "Home"
                    on_release: app.show_main_screen(*args)
                    
                MDRectangleFlatButton:
                    text: "Rest"
                    on_release: map_wid.rest()

                MDRectangleFlatButton:
                    text: "Loot"
                    on_release: map_wid.loot()

                MDRectangleFlatButton:
                    text: "Follow stairs"
                    on_release: map_wid.follow_stairs()
                    
                MDRectangleFlatButton:
                    text: "Quit"
                    on_release: app.stop()

                MDLabel:
                    id: select_mode_lbl
                    text: ""
